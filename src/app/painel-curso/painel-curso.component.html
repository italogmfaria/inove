<div class="curso-container">
  <!-- Top Bar -->
  <header class="top-bar">
    <img src="assets/logowhite.png" (click)="navigateTo('/inicial')" alt="Logotipo INOVE" class="logo">
    <h1>{{ courseTitle }}</h1>
    <button class="btn-orange" onclick="window.history.back();">Voltar</button>
  </header>

  <div class="content">
    <!-- Área de visualização (Vídeo ou PDF) -->
    <div class="viewer" *ngIf="currentContentUrl">  
      
      <!-- Loading Spinner -->
      <div class="loading-spinner" *ngIf="isContentLoading">
        <div class="spinner"></div>
        <p>Carregando conteúdo...</p>
      </div>
      
      <!-- Exibição de Vídeo -->
      <video class="video-area" *ngIf="currentContentUrl.toString().toLowerCase().endsWith('.mp4') && !isContentLoading" 
             controls preload="metadata" (loadeddata)="onContentLoaded()">
        <source [src]="currentContentUrl" type="video/mp4">
        Seu navegador não suporta vídeos.
      </video>

      <!-- Exibição de PDF com ng2-pdf-viewer -->
      <div class="pdf-container" *ngIf="currentContentUrl.toString().toLowerCase().endsWith('.pdf') && !isContentLoading">
        <pdf-viewer class="pdf-area"
                    [src]="currentContentUrl"
                    [render-text]="true">
        </pdf-viewer>
      </div>
    </div>

    <!-- Painel de Conteúdo -->
    <aside class="content-panel">
      <h2>Conteúdos do curso:</h2>
      <div class="section" *ngFor="let section of sections; let i = index">
        <button class="section-toggle" (click)="toggleSection(i)">
          {{ section.title }} <span [innerHTML]="section.isOpen ? '&#9660;' : '&#9658;'"></span>
        </button>

        <ul *ngIf="section.isOpen">
          <li *ngFor="let content of section.contents">
            <button class="content-btn" (click)="changeContent(content)">
              <img
                [src]="content.contentType === 'VIDEO' ? 'assets/flaticons/video.png' : 'assets/flaticons/pdf.png'"
                alt="Content Type Icon"
                class="content-icon"
              />
              {{ content.title }}
            </button>
          </li>
        </ul>
      </div>
    </aside>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p><strong>Descrição:</strong> {{ description }}</p>
    <p><strong>Instrutor:</strong> {{ instructor }}</p>
    <p><strong>Data de Criação:</strong> {{ courseCreationDate | date: 'dd/MM/yyyy' }}</p>
    <p><strong>Última Atualização:</strong> {{ lastUpdateDate | date: 'dd/MM/yyyy' }}</p>
  </footer>

  <!-- Comments Section -->
  <section class="comments-section">
    <h2 class="comments-title">Comentários:</h2>
    
    <div class="comments-list">
      <div class="comment" *ngFor="let feedback of course?.feedBacks">
        <p class="comment-user"><strong>{{ feedback.student.name }}</strong></p>
        <p class="comment-text">{{ feedback.comment }}</p>
      </div>
    </div>
  
    <div class="user-comment-section">
      <div *ngIf="userFeedback && !isEditing" class="existing-comment">
        <p><strong>Seu comentário:</strong> {{ userFeedback.comment }}</p>
        <div class="comment-actions">
          <button class="btn-blue" (click)="enableEdit()">Editar</button>
          <button class="btn-red" (click)="deleteFeedback()">Excluir</button>
        </div>
      </div>
  
      <div *ngIf="!userFeedback && !isEditing">
        <button class="btn-orange" (click)="isEditing = true">Inserir comentário</button>
      </div>
  
      <div *ngIf="isEditing" class="comment-box">
        <textarea [(ngModel)]="newComment" placeholder="Escreva seu comentário aqui..." rows="4"></textarea>
        <div class="comment-box-actions">
          <button class="btn-submit" (click)="addOrUpdateFeedback()" [disabled]="!newComment.trim()">{{ userFeedback ? 'Atualizar' : 'Enviar' }}</button>
          <button class="btn-cancel" (click)="cancelEdit()">Cancelar</button>
        </div>
      </div>
    </div>
  </section>  
</div>
