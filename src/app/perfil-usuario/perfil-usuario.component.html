<body>
    <div class="background-decoration">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
    </div>

    <div class="perfil-container">
        <header class="header">
            <button class="back-btn" (click)="navigateTo('/cursos')">
                <span class="material-icons">arrow_back</span>
                <span class="back-text">Voltar</span>
            </button>
            <img src="assets/logowhite.png" alt="Logotipo INOVE" (click)="navigateTo('/cursos')" class="logo">
        </header>

        <div class="content">
            <aside class="side-panel">
                <div class="panel-header">
                    <h2>Painel do Usuário</h2>
                </div>

                <ul class="menu-list">
                    <li (click)="switchPanel('cursos')" [class.active]="activePanel === 'cursos'">
                        <span class="material-icons">school</span>
                        <span>Meus Cursos</span>
                    </li>
                    <li (click)="switchPanel('dados')" [class.active]="activePanel === 'dados'">
                        <span class="material-icons">person</span>
                        <span>Meus Dados</span>
                    </li>
                </ul>

                <button class="btn-logout" (click)="logout()">
                    <span class="material-icons">logout</span>
                    <span>Sair</span>
                </button>
            </aside>

            <main class="main-panel">
                <div *ngIf="activePanel === 'cursos'" class="panel-content">
                    <div class="panel-title">
                        <span class="material-icons title-icon">school</span>
                        <h1>Meus Cursos</h1>
                    </div>

                    <div *ngIf="userCourses.length === 0" class="empty-state">
                        <span class="material-icons empty-icon">auto_stories</span>
                        <h3>Você ainda não está inscrito em nenhum curso</h3>
                        <p>Explore nossa plataforma e comece sua jornada de aprendizado!</p>
                        <button class="btn-primary" (click)="navigateTo('/cursos')">
                            <span class="material-icons">explore</span>
                            <span>Explorar Cursos</span>
                        </button>
                    </div>

                    <div class="course-grid" *ngIf="userCourses.length > 0">
                        <div *ngFor="let course of userCourses" class="course-card">
                            <div class="course-image-container" (click)="navigateToCourse(course.id)">
                                <img [src]="courseImages[course.id] || 'assets/placeholder.png'" alt="{{ course.name }}" class="course-image">
                                <div class="course-overlay">
                                    <span class="material-icons">play_circle</span>
                                    <span>Continuar Curso</span>
                                </div>
                            </div>
                            <div class="course-content">
                                <h3 class="course-title" (click)="navigateToCourse(course.id)">{{ course.name }}</h3>
                                <p class="course-description">{{ course.description }}</p>

                                <!-- Progress Bar -->
                                <div class="course-progress">
                                    <div class="progress-header">
                                        <span class="progress-label">Progresso do curso</span>
                                        <span class="progress-percentage">{{ getCourseProgress(course.id) }}%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" [style.width.%]="getCourseProgress(course.id)"></div>
                                    </div>
                                </div>

                                <div class="course-actions">
                                    <button class="btn-continue" (click)="navigateToCourse(course.id)">
                                        <span class="material-icons">play_arrow</span>
                                        <span>Continuar</span>
                                    </button>
                                    <button class="btn-remove" (click)="removeCourse(course.id); $event.stopPropagation();">
                                        <span class="material-icons">delete</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="activePanel === 'dados'" class="panel-content">
                    <div class="panel-title">
                        <span class="material-icons title-icon">badge</span>
                        <h1>Meus Dados</h1>
                    </div>

                    <div class="user-info-card">
                        <div class="info-row">
                            <div class="info-label">
                                <span class="material-icons">person</span>
                                <span>Nome</span>
                            </div>
                            <div class="info-value">{{ user.name }}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">
                                <span class="material-icons">email</span>
                                <span>Email</span>
                            </div>
                            <div class="info-value">{{ user.email }}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">
                                <span class="material-icons">credit_card</span>
                                <span>CPF</span>
                            </div>
                            <div class="info-value">{{ user.cpf | mask: '000.000.000-00' }}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">
                                <span class="material-icons">school</span>
                                <span>Escola</span>
                            </div>
                            <div class="info-value">{{ getSchoolName() }}</div>
                        </div>

                        <button class="btn-edit" (click)="toggleEdit()">
                            <span class="material-icons">edit</span>
                            <span>Editar Dados</span>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal de Editar Dados -->
    <div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
        <div class="modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>
                    <span class="material-icons">edit</span>
                    Editar Dados
                </h2>
                <button class="close-btn" (click)="closeEditModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>

            <form class="modal-form" [formGroup]="editUserForm" (ngSubmit)="saveUserData()">
                <div class="input-group" [class.error]="isFieldInvalid('name')">
                    <span class="material-icons input-icon">person</span>
                    <input
                        id="edit-nome"
                        type="text"
                        formControlName="name"
                        placeholder="Digite seu nome completo"
                        class="input-field"
                        [class.invalid]="isFieldInvalid('name')" />
                    <small class="error-message" *ngIf="isFieldInvalid('name')">
                        {{ getErrorMessage('name') }}
                    </small>
                </div>

                <div class="input-group" [class.error]="isFieldInvalid('email')">
                    <span class="material-icons input-icon">email</span>
                    <input
                        id="edit-email"
                        type="email"
                        formControlName="email"
                        placeholder="Digite seu e-mail"
                        class="input-field"
                        [class.invalid]="isFieldInvalid('email')" />
                    <small class="error-message" *ngIf="isFieldInvalid('email')">
                        {{ getErrorMessage('email') }}
                    </small>
                </div>

                <div class="input-group" [class.error]="isFieldInvalid('cpf')">
                    <span class="material-icons input-icon">credit_card</span>
                    <input
                        id="edit-cpf"
                        type="text"
                        formControlName="cpf"
                        cpfMask
                        placeholder="000.000.000-00"
                        class="input-field"
                        [class.invalid]="isFieldInvalid('cpf')" />
                    <small class="error-message" *ngIf="isFieldInvalid('cpf')">
                        {{ getErrorMessage('cpf') }}
                    </small>
                </div>

                <div class="input-group">
                    <span class="material-icons input-icon">school</span>
                    <select
                        id="edit-school"
                        formControlName="schoolId"
                        class="input-field">
                        <option [ngValue]="null">Selecione sua escola</option>
                        <option *ngFor="let school of schools" [ngValue]="school.id">{{ school.name }}</option>
                    </select>
                </div>

                <p class="school-register-link">
                    Não tem sua escola cadastrada?
                    <a (click)="navigateTo('/cadastro-escola')" class="btn-link">Cadastre sua Escola!</a>
                </p>

                <button type="submit" class="btn-save" [disabled]="editUserForm.invalid">
                    <span class="material-icons">save</span>
                    <span>Salvar Alterações</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div class="modal-overlay" *ngIf="showConfirmModal" (click)="cancelConfirmation()">
        <div class="modal confirm-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <div class="confirm-icon" [ngClass]="confirmationType">
                    <span class="material-icons">{{ confirmationType === 'delete' ? 'warning' : 'logout' }}</span>
                </div>
            </div>

            <div class="confirm-content">
                <h2>{{ confirmationTitle }}</h2>
                <p>{{ confirmationMessage }}</p>
            </div>

            <div class="confirm-actions">
                <button class="btn-cancel" (click)="cancelConfirmation()">
                    <span class="material-icons">close</span>
                    <span>Cancelar</span>
                </button>
                <button class="btn-confirm" [ngClass]="confirmationType" (click)="confirmAction()">
                    <span class="material-icons">{{ confirmationType === 'delete' ? 'delete_forever' : 'logout' }}</span>
                    <span>{{ confirmationType === 'delete' ? 'Remover' : 'Sair' }}</span>
                </button>
            </div>
        </div>
    </div>
</body>
