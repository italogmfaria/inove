<div class="admin-container">
  <div class="background-decoration">
    <div class="circle circle-1"></div>
    <div class="circle circle-2"></div>
    <div class="circle circle-3"></div>
  </div>

  <header class="header">
    <img src="assets/logowhite.png" (click)="navigateTo('/painel-admin')" alt="Logotipo INOVE" class="logo">
    <h1 class="admin-title">Painel Administrativo</h1>
    <button class="btn-logout" (click)="logout()">
      <span class="material-icons">logout</span>
      <span>Sair</span>
    </button>
  </header>

  <div class="content">
    <aside class="side-menu">
      <h2>
        Administração
      </h2>
      <ul>
        <li (click)="changeTab('usuarios')" [class.active]="activeTab === 'usuarios'">
          <span class="material-icons">group</span>
          <span>Usuários</span>
        </li>
        <li (click)="changeTab('escolas')" [class.active]="activeTab === 'escolas'">
          <span class="material-icons">school</span>
          <span>Escolas</span>
        </li>
        <li (click)="changeTab('cursos')" [class.active]="activeTab === 'cursos'">
          <span class="material-icons">menu_book</span>
          <span>Cursos</span>
        </li>
      </ul>
    </aside>

    <main class="main-content">
      <div *ngIf="activeTab === 'usuarios'" class="tab-content">
        <div class="content-header">
          <h1>
            <span class="material-icons">group</span>
            Usuários Cadastrados
          </h1>
        </div>
        <div class="search-bar">
          <span class="material-icons search-icon">search</span>
          <input
            type="text"
            [(ngModel)]="searchUsuarios"
            placeholder="Pesquisar por nome, email ou tipo..."
            class="search-input" />
          <span class="search-count">{{ filteredUsuarios.length }} {{ filteredUsuarios.length === 1 ? 'usuário' : 'usuários' }}</span>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th><span class="material-icons">person</span> Nome</th>
                <th><span class="material-icons">email</span> Email</th>
                <th><span class="material-icons">badge</span> Tipo</th>
                <th><span class="material-icons">settings</span> Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let usuario of filteredUsuarios">
                <td>{{ usuario.name }}</td>
                <td>{{ usuario.email }}</td>
                <td><span class="role-badge" [class]="'role-' + usuario.role.toLowerCase()">{{ usuario.role }}</span></td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-action btn-edit" (click)="toggleUpdateUserModal(usuario)">
                      <span class="material-icons">edit</span>
                      Atualizar
                    </button>
                    <button class="btn-action btn-delete" (click)="deleteUser(usuario)">
                      <span class="material-icons">delete</span>
                      Remover
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <button class="btn-add" (click)="toggleAddUserModal()">
          <span class="material-icons">add_circle</span>
          Adicionar Novo Usuário
        </button>
      </div>

      <div *ngIf="activeTab === 'escolas'" class="tab-content">
        <div class="content-header">
          <h1>
            <span class="material-icons">school</span>
            Escolas Cadastradas
          </h1>
        </div>
        <div class="search-bar">
          <span class="material-icons search-icon">search</span>
          <input
            type="text"
            [(ngModel)]="searchEscolas"
            placeholder="Pesquisar por nome, email, cidade ou estado..."
            class="search-input" />
          <span class="search-count">{{ filteredEscolas.length }} {{ filteredEscolas.length === 1 ? 'escola' : 'escolas' }}</span>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th><span class="material-icons">business</span> Nome</th>
                <th><span class="material-icons">email</span> Email</th>
                <th><span class="material-icons">location_city</span> Cidade</th>
                <th><span class="material-icons">map</span> Estado</th>
                <th><span class="material-icons">settings</span> Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let escola of filteredEscolas">
                <td>{{ escola.name }}</td>
                <td>{{ escola.email }}</td>
                <td>{{ escola.city }}</td>
                <td>{{ escola.federativeUnit }}</td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-action btn-edit" (click)="toggleSchoolModal(escola)">
                      <span class="material-icons">edit</span>
                      Atualizar
                    </button>
                    <button class="btn-action btn-delete" (click)="deleteSchool(escola)">
                      <span class="material-icons">delete</span>
                      Remover
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <button class="btn-add" (click)="toggleNewSchoolModal()">
          <span class="material-icons">add_circle</span>
          Adicionar Nova Escola
        </button>
      </div>

      <div *ngIf="activeTab === 'cursos'" class="tab-content">
        <div class="content-header">
          <h1>
            <span class="material-icons">menu_book</span>
            Cursos Cadastrados
          </h1>
        </div>
        <div class="search-bar">
          <span class="material-icons search-icon">search</span>
          <input
            type="text"
            [(ngModel)]="searchCursos"
            placeholder="Pesquisar por título, descrição ou instrutor..."
            class="search-input" />
          <span class="search-count">{{ filteredCursos.length }} {{ filteredCursos.length === 1 ? 'curso' : 'cursos' }}</span>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th><span class="material-icons">title</span> Título</th>
                <th><span class="material-icons">description</span> Descrição</th>
                <th><span class="material-icons">person_outline</span> Instrutores</th>
                <th><span class="material-icons">settings</span> Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let curso of filteredCursos">
                <td>{{ curso.name }}</td>
                <td class="description-cell">{{ curso.description }}</td>
                <td>
                  <span *ngIf="curso.instructors.length > 0; else noInstructors" class="instructors-list-cell">
                    <span *ngFor="let instrutor of curso.instructors; let last = last">
                      {{ instrutor.name }}<span *ngIf="!last">, </span>
                    </span>
                  </span>
                  <ng-template #noInstructors><span class="no-data">Sem instrutores</span></ng-template>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-action btn-edit" (click)="openUpdateCourseModal(curso)">
                      <span class="material-icons">edit</span>
                      Atualizar
                    </button>
                    <button class="btn-action btn-delete" (click)="deleteCourse(curso)">
                      <span class="material-icons">delete</span>
                      Remover
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <button class="btn-add" (click)="openAddCourseModal()">
          <span class="material-icons">add_circle</span>
          Adicionar Novo Curso
        </button>
      </div>
    </main>
  </div>

  <div class="modal-overlay" *ngIf="showAddUserModal" (click)="closeUserModals()"></div>
  <div class="modal" *ngIf="showAddUserModal">
    <header class="modal-header">
      <h2><span class="material-icons">person_add</span> Adicionar Novo Usuário</h2>
      <span class="close-btn" (click)="closeUserModals()">
        <span class="material-icons">close</span>
      </span>
    </header>
    <form [formGroup]="addUserForm" (ngSubmit)="addUser()">
      <div class="modal-body">
        <div class="input-group" [class.error]="isFieldInvalid('name', 'user')">
          <span class="material-icons">person</span>
          <input type="text" formControlName="name" placeholder="Nome Completo"
                 [class.invalid]="isFieldInvalid('name', 'user')" />
          <small class="error-message" *ngIf="isFieldInvalid('name', 'user')">
            {{ getErrorMessage('name', 'user') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('email', 'user')">
          <span class="material-icons">email</span>
          <input type="email" formControlName="email" placeholder="E-mail"
                 [class.invalid]="isFieldInvalid('email', 'user')" />
          <small class="error-message" *ngIf="isFieldInvalid('email', 'user')">
            {{ getErrorMessage('email', 'user') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('cpf', 'user')">
          <span class="material-icons">badge</span>
          <input type="text" formControlName="cpf" placeholder="000.000.000-00" mask="000.000.000-00"
                 [class.invalid]="isFieldInvalid('cpf', 'user')" />
          <small class="error-message" *ngIf="isFieldInvalid('cpf', 'user')">
            {{ getErrorMessage('cpf', 'user') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('password', 'user')">
          <span class="material-icons">lock</span>
          <div class="password-wrapper">
            <input [type]="showPassword ? 'text' : 'password'" formControlName="password" placeholder="Senha"
                   [class.invalid]="isFieldInvalid('password', 'user')" />
            <span class="material-icons password-toggle-icon" (click)="togglePasswordVisibility()">
              {{ showPassword ? 'visibility_off' : 'visibility' }}
            </span>
          </div>
          <small class="error-message" *ngIf="isFieldInvalid('password', 'user')">
            {{ getErrorMessage('password', 'user') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('role', 'user')">
          <span class="material-icons">assignment_ind</span>
          <select formControlName="role" [class.invalid]="isFieldInvalid('role', 'user')">
            <option value="" disabled>Selecione o tipo de usuário</option>
            <option [value]="UserRole.STUDENT">Estudante</option>
            <option [value]="UserRole.INSTRUCTOR">Instrutor</option>
            <option [value]="UserRole.ADMINISTRATOR">Administrador</option>
          </select>
          <small class="error-message" *ngIf="isFieldInvalid('role', 'user')">
            {{ getErrorMessage('role', 'user') }}
          </small>
        </div>
        <div *ngIf="addUserForm.get('role')?.value === 'STUDENT'" class="input-group">
          <span class="material-icons">school</span>
          <select formControlName="schoolId">
            <option [value]="null">Selecione a escola</option>
            <option *ngFor="let escola of escolas" [value]="escola.id">{{ escola.name }}</option>
          </select>
        </div>
      </div>
      <footer class="modal-footer">
        <button type="submit" class="btn-modal-save" [disabled]="addUserForm.invalid">
          <span class="material-icons">save</span>
          Salvar
        </button>
        <button type="button" class="btn-modal-cancel" (click)="closeUserModals()">
          <span class="material-icons">cancel</span>
          Cancelar
        </button>
      </footer>
    </form>
  </div>

  <div class="modal-overlay" *ngIf="showUpdateUserModal" (click)="closeUserModals()"></div>
  <div class="modal" *ngIf="showUpdateUserModal">
    <header class="modal-header">
      <h2><span class="material-icons">edit</span> Atualizar Usuário</h2>
      <span class="close-btn" (click)="closeUserModals()">
        <span class="material-icons">close</span>
      </span>
    </header>
    <form [formGroup]="updateUserForm" (ngSubmit)="updateUser()">
      <div class="modal-body">
        <div class="input-group" [class.error]="isFieldInvalid('name', 'user')">
          <span class="material-icons">person</span>
          <input type="text" formControlName="name" placeholder="Nome Completo"
                 [class.invalid]="isFieldInvalid('name', 'user')" />
          <small class="error-message" *ngIf="isFieldInvalid('name', 'user')">
            {{ getErrorMessage('name', 'user') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('email', 'user')">
          <span class="material-icons">email</span>
          <input type="email" formControlName="email" placeholder="E-mail"
                 [class.invalid]="isFieldInvalid('email', 'user')" />
          <small class="error-message" *ngIf="isFieldInvalid('email', 'user')">
            {{ getErrorMessage('email', 'user') }}
          </small>
        </div>
      </div>
      <footer class="modal-footer">
        <button type="submit" class="btn-modal-save" [disabled]="updateUserForm.invalid">
          <span class="material-icons">save</span>
          Salvar
        </button>
        <button type="button" class="btn-modal-cancel" (click)="closeUserModals()">
          <span class="material-icons">cancel</span>
          Cancelar
        </button>
      </footer>
    </form>
  </div>

  <div class="modal-overlay" *ngIf="showNewSchoolModal" (click)="toggleNewSchoolModal()"></div>
  <div class="modal" *ngIf="showNewSchoolModal">
    <header class="modal-header">
      <h2><span class="material-icons">add_business</span> Adicionar Nova Escola</h2>
      <span class="close-btn" (click)="toggleNewSchoolModal()">
        <span class="material-icons">close</span>
      </span>
    </header>
    <form [formGroup]="addSchoolForm" (ngSubmit)="addNewSchool()">
      <div class="modal-body">
        <div class="input-group" [class.error]="isFieldInvalid('name', 'school')">
          <span class="material-icons">business</span>
          <input type="text" formControlName="name" placeholder="Nome da Escola"
                 [class.invalid]="isFieldInvalid('name', 'school')" />
          <small class="error-message" *ngIf="isFieldInvalid('name', 'school')">
            {{ getErrorMessage('name', 'school') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('email', 'school')">
          <span class="material-icons">email</span>
          <input type="email" formControlName="email" placeholder="Email"
                 [class.invalid]="isFieldInvalid('email', 'school')" />
          <small class="error-message" *ngIf="isFieldInvalid('email', 'school')">
            {{ getErrorMessage('email', 'school') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('city', 'school')">
          <span class="material-icons">location_city</span>
          <input type="text" formControlName="city" placeholder="Cidade"
                 [class.invalid]="isFieldInvalid('city', 'school')" />
          <small class="error-message" *ngIf="isFieldInvalid('city', 'school')">
            {{ getErrorMessage('city', 'school') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('federativeUnit', 'school')">
          <span class="material-icons">map</span>
          <input type="text" formControlName="federativeUnit" placeholder="Estado (UF)" maxlength="2"
                 [class.invalid]="isFieldInvalid('federativeUnit', 'school')" />
          <small class="error-message" *ngIf="isFieldInvalid('federativeUnit', 'school')">
            {{ getErrorMessage('federativeUnit', 'school') }}
          </small>
        </div>
      </div>
      <footer class="modal-footer">
        <button type="submit" class="btn-modal-save" [disabled]="addSchoolForm.invalid">
          <span class="material-icons">save</span>
          Salvar
        </button>
        <button type="button" class="btn-modal-cancel" (click)="toggleNewSchoolModal()">
          <span class="material-icons">cancel</span>
          Cancelar
        </button>
      </footer>
    </form>
  </div>

  <div class="modal-overlay" *ngIf="showSchoolModal" (click)="closeSchoolModal()"></div>
  <div class="modal" *ngIf="showSchoolModal">
    <header class="modal-header">
      <h2><span class="material-icons">edit</span> Atualizar Escola</h2>
      <span class="close-btn" (click)="closeSchoolModal()">
        <span class="material-icons">close</span>
      </span>
    </header>
    <form [formGroup]="updateSchoolForm" (ngSubmit)="updateSchool()">
      <div class="modal-body">
        <div class="input-group" [class.error]="isFieldInvalid('name', 'school')">
          <span class="material-icons">business</span>
          <input type="text" formControlName="name" placeholder="Nome da Escola"
                 [class.invalid]="isFieldInvalid('name', 'school')" />
          <small class="error-message" *ngIf="isFieldInvalid('name', 'school')">
            {{ getErrorMessage('name', 'school') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('email', 'school')">
          <span class="material-icons">email</span>
          <input type="email" formControlName="email" placeholder="E-mail de Contato"
                 [class.invalid]="isFieldInvalid('email', 'school')" />
          <small class="error-message" *ngIf="isFieldInvalid('email', 'school')">
            {{ getErrorMessage('email', 'school') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('city', 'school')">
          <span class="material-icons">location_city</span>
          <input type="text" formControlName="city" placeholder="Cidade"
                 [class.invalid]="isFieldInvalid('city', 'school')" />
          <small class="error-message" *ngIf="isFieldInvalid('city', 'school')">
            {{ getErrorMessage('city', 'school') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('federativeUnit', 'school')">
          <span class="material-icons">map</span>
          <input type="text" formControlName="federativeUnit" placeholder="Estado (UF)" maxlength="2"
                 [class.invalid]="isFieldInvalid('federativeUnit', 'school')" />
          <small class="error-message" *ngIf="isFieldInvalid('federativeUnit', 'school')">
            {{ getErrorMessage('federativeUnit', 'school') }}
          </small>
        </div>
      </div>
      <footer class="modal-footer">
        <button type="submit" class="btn-modal-save" [disabled]="updateSchoolForm.invalid">
          <span class="material-icons">save</span>
          Salvar
        </button>
        <button type="button" class="btn-modal-cancel" (click)="closeSchoolModal()">
          <span class="material-icons">cancel</span>
          Cancelar
        </button>
      </footer>
    </form>
  </div>

  <div class="modal-overlay" *ngIf="showAddCourseModal" (click)="closeAddCourseModal()"></div>
  <div class="modal" *ngIf="showAddCourseModal">
    <header class="modal-header">
      <h2><span class="material-icons">add_circle_outline</span> Adicionar Novo Curso</h2>
      <span class="close-btn" (click)="closeAddCourseModal()">
        <span class="material-icons">close</span>
      </span>
    </header>
    <form [formGroup]="addCourseForm" (ngSubmit)="addCourse()">
      <div class="modal-body">
        <div class="input-group" [class.error]="isFieldInvalid('name', 'course')">
          <span class="material-icons">title</span>
          <input type="text" formControlName="name" placeholder="Título do Curso"
                 [class.invalid]="isFieldInvalid('name', 'course')" />
          <small class="error-message" *ngIf="isFieldInvalid('name', 'course')">
            {{ getErrorMessage('name', 'course') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('description', 'course')">
          <span class="material-icons">description</span>
          <textarea formControlName="description" placeholder="Descrição do curso"
                    [class.invalid]="isFieldInvalid('description', 'course')"></textarea>
          <small class="error-message" *ngIf="isFieldInvalid('description', 'course')">
            {{ getErrorMessage('description', 'course') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('instructorId', 'course')">
          <span class="material-icons">person_outline</span>
          <select formControlName="instructorId" [class.invalid]="isFieldInvalid('instructorId', 'course')">
            <option [ngValue]="null">Selecione um instrutor</option>
            <option *ngFor="let instrutor of instrutores" [ngValue]="instrutor.id">
              {{ instrutor.name }}
            </option>
          </select>
          <small class="error-message" *ngIf="isFieldInvalid('instructorId', 'course')">
            {{ getErrorMessage('instructorId', 'course') }}
          </small>
        </div>
      </div>
      <footer class="modal-footer">
        <button type="submit" class="btn-modal-save" [disabled]="addCourseForm.invalid">
          <span class="material-icons">save</span>
          Salvar
        </button>
        <button type="button" class="btn-modal-cancel" (click)="closeAddCourseModal()">
          <span class="material-icons">cancel</span>
          Cancelar
        </button>
      </footer>
    </form>
  </div>

  <div class="modal-overlay" *ngIf="showUpdateCourseModal" (click)="closeUpdateCourseModal()"></div>
  <div class="modal" *ngIf="showUpdateCourseModal">
    <header class="modal-header">
      <h2><span class="material-icons">edit</span> Atualizar Curso</h2>
      <span class="close-btn" (click)="closeUpdateCourseModal()">
        <span class="material-icons">close</span>
      </span>
    </header>
    <form [formGroup]="updateCourseForm" (ngSubmit)="updateCourse()">
      <div class="modal-body">
        <div class="input-group" [class.error]="isFieldInvalid('name', 'course')">
          <span class="material-icons">title</span>
          <input type="text" formControlName="name" placeholder="Título do Curso"
                 [class.invalid]="isFieldInvalid('name', 'course')" />
          <small class="error-message" *ngIf="isFieldInvalid('name', 'course')">
            {{ getErrorMessage('name', 'course') }}
          </small>
        </div>
        <div class="input-group" [class.error]="isFieldInvalid('description', 'course')">
          <span class="material-icons">description</span>
          <textarea formControlName="description" placeholder="Descrição do curso"
                    [class.invalid]="isFieldInvalid('description', 'course')"></textarea>
          <small class="error-message" *ngIf="isFieldInvalid('description', 'course')">
            {{ getErrorMessage('description', 'course') }}
          </small>
        </div>
        <div class="input-group">
          <span class="material-icons">person_outline</span>
          <select formControlName="instructorId">
            <option [ngValue]="null">Selecione um instrutor</option>
            <option *ngFor="let instrutor of instrutores" [ngValue]="instrutor.id">
              {{ instrutor.name }}
            </option>
          </select>
        </div>
      </div>
      <footer class="modal-footer">
        <button type="submit" class="btn-modal-save" [disabled]="updateCourseForm.invalid">
          <span class="material-icons">save</span>
          Salvar
        </button>
        <button type="button" class="btn-modal-cancel" (click)="closeUpdateCourseModal()">
          <span class="material-icons">cancel</span>
          Cancelar
        </button>
      </footer>
    </form>
  </div>

  <div class="modal-overlay" *ngIf="showConfirmModal" (click)="cancelConfirmation()">
    <div class="modal confirm-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="confirm-icon" [ngClass]="confirmationType">
          <span class="material-icons">{{ confirmationType === 'delete' ? 'warning' : 'logout' }}</span>
        </div>
      </div>

      <div class="confirm-content">
        <h2>{{ confirmationTitle }}</h2>
        <p>{{ confirmationMessage }}</p>
      </div>

      <div class="confirm-actions">
        <button class="btn-cancel" (click)="cancelConfirmation()">
          <span class="material-icons">close</span>
          <span>Cancelar</span>
        </button>
        <button class="btn-confirm" [ngClass]="confirmationType" (click)="confirmAction()">
          <span class="material-icons">{{ confirmationType === 'delete' ? 'delete_forever' : 'logout' }}</span>
          <span>{{ confirmationType === 'delete' ? 'Remover' : 'Sair' }}</span>
        </button>
      </div>
    </div>
  </div>
</div>
